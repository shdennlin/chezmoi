{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash

# Define color codes
NC="\033[0m"
INFO="\033[1;32m"      # Green
WARNING="\033[1;33m"   # Yellow
ERROR="\033[1;31m"     # Red
DEBUG="\033[1;34m"     # Blue
FATAL="\033[1;41m"     # Red background
HIGHLIGHT="\033[1;36m" # Cyan
CMD="\033[1;90m"       # Gray
SUCCESS="\033[1;92m"   # Bright Green

set -eu
echo "Installing packages..."

{{ if .packages.linux.apt -}}
## TODO: Add Arch Linux support
echo "Updating apt..."
sudo apt update
{{ end -}}
{{ range .packages.linux.apt -}}
package={{ . | quote }}
cmd="sudo apt-get install $package -qq -y"
eval "sudo apt-get install $package -qq -y > /dev/null 2>&1 | tee; exit_code=\${PIPESTATUS[0]};"
if [ $exit_code -eq 0 ]; then
  echo -e "${INFO}Package $package\tinstalled successfully.\t${CMD} $cmd${NC}"
else
  echo -e "${HIGHLIGHT}Package $package\tnot found, Skipping...\t${CMD} $cmd${NC}"
fi
{{ end -}}

{{ range .packages.linux.cmd}}
package={{ . | quote }}
# Remove the square brackets
content=${package#[}
content=${content%]}
# Use read to split into variables
read package_name judge_cmd install_cmd <<< "$(echo "$content" | awk '{print $1, $2, substr($0, index($0,$3))}')"

if ! command -v ${judge_cmd} >/dev/null; then
  echo -e "${INFO}Installing ${package_name}... ${CMD}${install_cmd}"
  eval "${install_cmd}"
  echo -en ${NC}
else
  echo -e "${HIGHLIGHT}${package_name}\tis already installed. Skipping...\t${CMD}${install_cmd}${NC}"
fi
{{ end -}}

echo -e "${SUCCESS}All packages installed successfully.${NC}"
{{ end -}}